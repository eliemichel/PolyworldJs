<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf8" />
		<title>Polyworld</title>
		<link href="style.css" type="text/css" rel="stylesheet" />
	</head>

	<body>
		<script id="injectAfterCommon" type="x-shader/x-vertex">

			uniform float time;

			attribute float radius;
			attribute vec2 height;

			float rand31(vec3 seed1, float seed2) {
				return rand(vec2(
					rand(seed1.xy),
					rand(vec2(seed1.z, seed2))
				));
			}

		</script>

		<script id="injectAfterBeginVertex" type="x-shader/x-vertex">

			//transformed.x += sin(time) * transformed.y + float(gl_InstanceID) * 3.0;

			// Radius
			transformed.xz *= radius;

			// Instance transformation
			transformed.x += float(gl_InstanceID) * 3.0;

			// Noise
			vec3 offset = vec3(
				rand31(transformed.xyz, 0.5 / 3.0),
				rand31(transformed.xyz, 1.5 / 3.0),
				rand31(transformed.xyz, 2.5 / 3.0)
			) - 0.5;
			transformed.xyz += normalize(offset) * 0.1 * radius;

		</script>

		<script id="injectAfterColorVertex" type="x-shader/x-vertex">

			vColor *= mix(1.0, 0.5, height.y);

		</script>

		<script type="importmap">
		{
			"imports": {
				"three": "./three.module.min.js",
				"three/addons/": "./three/addons/"
			}
		}
		</script>
		<script type="module" src="main.js"></script>
	</body>
</html>
